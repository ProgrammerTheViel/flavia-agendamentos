<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flavia Viel Agendamentos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Reset e configurações gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #ff6b8b;
            --secondary: #9d4edd;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        /* Login Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal h2 {
            margin-bottom: 1.5rem;
            color: var(--dark);
            text-align: center;
        }
        
        .error-message {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--danger);
            display: none;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin: 2rem auto 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 600px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--gray);
        }
        
        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        /* Conteúdo das abas */
        .tab-content {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            min-height: 400px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Formulários */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: var(--gray);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        /* Grade de horários */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 1rem;
        }
        
        .time-slot {
            padding: 0.75rem;
            text-align: center;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .time-slot:hover {
            border-color: var(--primary);
            background-color: rgba(255, 107, 139, 0.05);
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .time-slot.booked {
            background-color: var(--light-gray);
            color: var(--gray);
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        /* Lista de agendamentos */
        .appointments-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .appointment-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .appointment-info h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .appointment-time {
            font-weight: 600;
            color: var(--dark);
            background: var(--light-gray);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.5rem;
        }
        
        .appointment-actions {
            display: flex;
            gap: 10px;
        }
        
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-confirmed {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }
        
        .status-pending {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }
        
        .status-cancelled {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }
        
        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            color: var(--dark);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .appointment-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .appointment-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .schedule-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 1.5rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Utilitários */
        .text-center {
            text-align: center;
        }
        
        .mb-3 {
            margin-bottom: 1.5rem;
        }
        
        .mt-3 {
            margin-top: 1.5rem;
        }
        
        .d-none {
            display: none;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        .alert-success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 5px solid var(--success);
            color: var(--success);
        }
        
        .alert-danger {
            background-color: rgba(244, 67, 54, 0.1);
            border-left: 5px solid var(--danger);
            color: var(--danger);
        }
        
        .admin-access {
            margin: 1rem auto;
            text-align: center;
        }
        
        .admin-access a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .admin-access a:hover {
            text-decoration: underline;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--gray);
            border-top: 1px solid var(--light-gray);
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Modal de Login -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal">
            <h2>Acesso Administrativo</h2>
            <div id="loginError" class="error-message"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" required placeholder="Digite sua senha">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn" style="width: 100%">Entrar</button>
                </div>
                <div class="text-center">
                    <button type="button" id="closeModal" class="btn-secondary" style="width: 100%">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="logo">
                <i class="fas fa-spa"></i>
                <span>Flávia Viel Nail Design</span>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Tabs para navegação -->
        <div class="tabs">
            <div class="tab active" data-tab="client">Agendar Horário</div>
            <div class="tab" data-tab="admin">Área Administrativa</div>
        </div>

        <!-- Conteúdo da aba do cliente -->
        <div id="client-tab" class="tab-content active">
            <h2 class="text-center mb-3">Agende seu horário</h2>
            
            <div id="success-message" class="alert alert-success d-none">
                Agendamento realizado com sucesso! Você receberá uma confirmação em breve.
            </div>
            
            <form id="booking-form">
                <div class="form-group">
                    <label for="client-name">Nome completo *</label>
                    <input type="text" id="client-name" required>
                </div>
                
                <div class="form-group">
                    <label for="client-phone">Telefone *</label>
                    <input type="tel" id="client-phone" required>
                </div>
                
                <div class="form-group">
                    <label for="service-type">Serviço desejado *</label>
                    <select id="service-type" required>
                        <option value="">Selecione um serviço</option>
                        <option value="mao">Mão</option>
                        <option value="pe">Pé</option>
                        <option value="pe_e_mao">Pé e Mão</option>
                        <option value="esmaltacao">Esmaltação</option>
                        <option value="alongamentos">Alongamentos</option>
                        <option value="manutencao_gel">Manutenção unhas de gel</option>
                        <option value="manutencao_fibra">Manutenção unhas de fibra</option>
                        <option value="reposicao">Reposição de unha</option>
                        <option value="esmaltacao_gel">Esmaltação em gel</option>
                        <option value="banho_gel">Banho de gel</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="appointment-date">Data do agendamento *</label>
                    <input type="date" id="appointment-date" required>
                </div>
                
                <div class="form-group">
                    <label>Horários disponíveis *</label>
                    <div class="schedule-grid" id="time-slots">
                        <!-- Os horários serão gerados dinamicamente via JavaScript -->
                    </div>
                    <input type="hidden" id="selected-time" required>
                </div>
                
                <div class="form-group">
                    <label for="notes">Observações (opcional)</label>
                    <textarea id="notes" rows="3" placeholder="Alguma preferência especial ou detalhe que devemos saber?"></textarea>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn">Confirmar Agendamento</button>
                </div>
            </form>
            
            <div class="admin-access">
                <p>É administrador? <a href="#" id="adminAccessLink">Acessar área administrativa</a></p>
            </div>
        </div>

        <!-- Conteúdo da aba administrativa -->
        <div id="admin-tab" class="tab-content">
            <h2 class="text-center mb-3">Área Administrativa</h2>
            
            <div id="adminDashboard" class="d-none">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <h3 id="total-appointments">0</h3>
                        <p>Agendamentos hoje</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3 id="pending-appointments">0</h3>
                        <p>Pendentes</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="total-clients">0</h3>
                        <p>Clientes cadastrados</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-money-bill-wave"></i>
                        <h3>R$ <span id="total-revenue">0</span></h3>
                        <p>Faturamento estimado</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="filter-date">Filtrar por data</label>
                    <input type="date" id="filter-date">
                </div>
                
                <h3 class="mt-3">Agendamentos</h3>
                <div class="appointments-list" id="admin-appointments-list">
                    <!-- Os agendamentos serão carregados dinamicamente via JavaScript -->
                </div>
                
                <div class="text-center mt-3">
                    <button class="btn btn-danger" id="logout-btn">Sair da área administrativa</button>
                </div>
            </div>
            
            <div id="loginRequired" class="text-center">
                <p>Área restrita. Faça login para continuar.</p>
                <button class="btn" id="openLoginModal">Fazer Login</button>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Flávia Viel Nail Design &copy; <span id="currentYear"></span></p>
            <p>Sistema de Agendamentos Online</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // ========== CONFIGURAÇÃO FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDftdET7O41Sw2zlTdBsHd1enhYIot3FgQ",
            authDomain: "flavia-agendamentos.firebaseapp.com",
            projectId: "flavia-agendamentos",
            storageBucket: "flavia-agendamentos.firebasestorage.app",
            messagingSenderId: "803549936998",
            appId: "1:803549936998:web:cfb7c67adeef088eed9ca7"
        };

        // ========== VARIÁVEIS GLOBAIS ==========
        let appointments = [];
        let currentUser = null;
        let isAdminAuthenticated = false;
        
        // ========== CONFIGURAÇÕES DO SISTEMA ==========
        const availableTimes = ["09:00", "09:30", "10:30", "12:00", "13:30", "15:00", "16:30", "18:00"];
        const servicePrices = {
            "mao": 35,
            "pe": 40,
            "pe_e_mao": 65,
            "esmaltacao": 20,
            "alongamentos": 185,
            "manutencao_gel": 120,
            "manutencao_fibra": 140,
            "reposicao": 15,
            "esmaltacao_gel": 80,
            "banho_gel": 110
        };
        
        const serviceNames = {
            "mao": "Mão",
            "pe": "Pé",
            "pe_e_mao": "Pé e Mão",
            "esmaltacao": "Esmaltação",
            "alongamentos": "Alongamentos",
            "manutencao_gel": "Manutenção unhas de gel",
            "manutencao_fibra": "Manutenção unhas de fibra",
            "reposicao": "Reposição de unha",
            "esmaltacao_gel": "Esmaltação em gel",
            "banho_gel": "Banho de gel"
        };
        
        // ========== INICIALIZAÇÃO DO FIREBASE ==========
        let db, auth;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            console.log("Firebase inicializado com sucesso!");
        } catch (error) {
            console.error("Erro ao inicializar Firebase:", error);
            alert("Erro ao conectar com o banco de dados. Verifique sua conexão com a internet.");
        }
        
        // ========== FUNÇÕES DO SISTEMA ==========
        function generateTimeSlots() {
            const selectedDate = document.getElementById('appointment-date').value;
            const timeSlotsContainer = document.getElementById('time-slots');
            const selectedTimeInput = document.getElementById('selected-time');
            
            if (!timeSlotsContainer || !selectedTimeInput) return;
            
            timeSlotsContainer.innerHTML = '';
            selectedTimeInput.value = '';
            
            const bookedTimes = appointments
                .filter(app => app.date === selectedDate && app.status !== 'cancelled')
                .map(app => app.time);
            
            availableTimes.forEach(time => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = time;
                
                if (bookedTimes.includes(time)) {
                    timeSlot.classList.add('booked');
                    timeSlot.title = 'Horário já reservado';
                } else {
                    timeSlot.addEventListener('click', function() {
                        document.querySelectorAll('.time-slot').forEach(slot => {
                            slot.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        selectedTimeInput.value = time;
                    });
                }
                
                timeSlotsContainer.appendChild(timeSlot);
            });
        }
        
        function updateAdminDashboard() {
            const today = new Date().toISOString().split('T')[0];
            
            const todayAppointments = appointments.filter(app => app.date === today && app.status !== 'cancelled');
            document.getElementById('total-appointments').textContent = todayAppointments.length;
            
            const pendingAppointments = appointments.filter(app => app.status === 'pending');
            document.getElementById('pending-appointments').textContent = pendingAppointments.length;
            
            const uniqueClients = new Set(appointments.map(app => app.clientName)).size;
            document.getElementById('total-clients').textContent = uniqueClients;
            
            const confirmedAppointments = appointments.filter(app => app.status === 'confirmed');
            let revenue = 0;
            confirmedAppointments.forEach(app => {
                revenue += servicePrices[app.service] || 0;
            });
            document.getElementById('total-revenue').textContent = revenue;
        }
        
        function loadAdminAppointments() {
            const adminAppointmentsList = document.getElementById('admin-appointments-list');
            const filterDate = document.getElementById('filter-date')?.value;
            
            if (!adminAppointmentsList) return;
            
            const filteredAppointments = appointments.filter(app => 
                (!filterDate || app.date === filterDate) && app.status !== 'cancelled'
            );
            
            adminAppointmentsList.innerHTML = '';
            
            if (filteredAppointments.length === 0) {
                adminAppointmentsList.innerHTML = '<p class="text-center">Nenhum agendamento encontrado para esta data.</p>';
                return;
            }
            
            filteredAppointments.sort((a, b) => {
                if (a.date === b.date) return a.time.localeCompare(b.time);
                return a.date.localeCompare(b.date);
            });
            
            filteredAppointments.forEach(appointment => {
                const appointmentCard = document.createElement('div');
                appointmentCard.className = 'appointment-card';
                
                const statusText = appointment.status === 'confirmed' ? 'Confirmado' : 
                                 appointment.status === 'cancelled' ? 'Cancelado' : 'Pendente';
                const statusClass = appointment.status === 'confirmed' ? 'status-confirmed' : 
                                  appointment.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                
                const dateObj = new Date(appointment.date + 'T00:00:00');
                const formattedDate = dateObj.toLocaleDateString('pt-BR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const serviceName = serviceNames[appointment.service] || appointment.service;
                const price = servicePrices[appointment.service] || 0;
                
                appointmentCard.innerHTML = `
                    <div class="appointment-info">
                        <h4>${appointment.clientName}</h4>
                        <p><strong>Serviço:</strong> ${serviceName} - R$ ${price}</p>
                        <p><strong>Telefone:</strong> ${appointment.phone}</p>
                        <p><strong>Data:</strong> ${formattedDate}</p>
                        <span class="appointment-time">${appointment.time}</span>
                        ${appointment.notes ? `<p class="mt-3"><strong>Observações:</strong> ${appointment.notes}</p>` : ''}
                    </div>
                    <div class="appointment-actions">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        ${appointment.status !== 'confirmed' ? 
                            `<button class="btn confirm-btn" data-id="${appointment.id}">Confirmar</button>` : ''}
                        ${appointment.status !== 'cancelled' ? 
                            `<button class="btn btn-secondary cancel-btn" data-id="${appointment.id}">Cancelar</button>` : ''}
                    </div>
                `;
                
                adminAppointmentsList.appendChild(appointmentCard);
            });
            
            document.querySelectorAll('.confirm-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    confirmAppointment(id);
                });
            });
            
            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    cancelAppointment(id);
                });
            });
        }
        
        // ========== FUNÇÕES FIREBASE ==========
        async function salvarAgendamentoNoFirestore(agendamento) {
            try {
                const docRef = await db.collection("agendamentos").add({
                    clientName: agendamento.clientName,
                    phone: agendamento.phone,
                    service: agendamento.service,
                    date: agendamento.date,
                    time: agendamento.time,
                    notes: agendamento.notes || '',
                    status: 'pending',
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log("Agendamento salvo com ID:", docRef.id);
                return { success: true, id: docRef.id };
            } catch (error) {
                console.error("Erro ao salvar agendamento:", error);
                return { success: false, error: error.message };
            }
        }
        
        async function carregarAgendamentosDoBanco() {
            try {
                const snapshot = await db.collection("agendamentos")
                    .orderBy("criadoEm", "desc")
                    .limit(100)
                    .get();
                
                appointments = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    appointments.push({
                        id: doc.id,
                        clientName: data.clientName,
                        phone: data.phone,
                        service: data.service,
                        date: data.date,
                        time: data.time,
                        notes: data.notes || '',
                        status: data.status || 'pending',
                        criadoEm: data.criadoEm ? data.criadoEm.toDate() : new Date()
                    });
                });
                
                console.log(`${appointments.length} agendamentos carregados`);
                generateTimeSlots();
                if (isAdminAuthenticated) {
                    updateAdminDashboard();
                    loadAdminAppointments();
                }
                
            } catch (error) {
                console.error("Erro ao carregar agendamentos:", error);
            }
        }
        
        async function atualizarStatusAgendamento(id, novoStatus) {
            try {
                await db.collection("agendamentos").doc(id).update({
                    status: novoStatus,
                    atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log(`Agendamento ${id} atualizado para ${novoStatus}`);
                return true;
            } catch (error) {
                console.error("Erro ao atualizar agendamento:", error);
                return false;
            }
        }
        
        async function fazerLogin(email, senha) {
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, senha);
                currentUser = userCredential.user;
                isAdminAuthenticated = true;
                console.log("Login realizado com sucesso:", currentUser.email);
                return { success: true };
            } catch (error) {
                console.error("Erro no login:", error.message);
                let errorMsg = "Erro ao fazer login. ";
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMsg += "Usuário não encontrado.";
                        break;
                    case 'auth/wrong-password':
                        errorMsg += "Senha incorreta.";
                        break;
                    case 'auth/invalid-email':
                        errorMsg += "Email inválido.";
                        break;
                    default:
                        errorMsg += error.message;
                }
                
                return { success: false, error: errorMsg };
            }
        }
        
        function fazerLogout() {
            auth.signOut().then(() => {
                currentUser = null;
                isAdminAuthenticated = false;
                console.log("Logout realizado com sucesso");
            }).catch(error => {
                console.error("Erro no logout:", error);
            });
        }
        
        // ========== FUNÇÕES DE INTERFACE ==========
        async function confirmAppointment(id) {
            if (!isAdminAuthenticated) {
                showLoginModal();
                return;
            }
            
            if (await atualizarStatusAgendamento(id, 'confirmed')) {
                const index = appointments.findIndex(app => app.id === id);
                if (index !== -1) appointments[index].status = 'confirmed';
                
                updateAdminDashboard();
                loadAdminAppointments();
                showAlert('Agendamento confirmado com sucesso!', 'success');
            } else {
                showAlert('Erro ao confirmar agendamento', 'error');
            }
        }
        
        async function cancelAppointment(id) {
            if (!isAdminAuthenticated) {
                showLoginModal();
                return;
            }
            
            if (confirm('Tem certeza que deseja cancelar este agendamento?')) {
                if (await atualizarStatusAgendamento(id, 'cancelled')) {
                    const index = appointments.findIndex(app => app.id === id);
                    if (index !== -1) appointments[index].status = 'cancelled';
                    
                    updateAdminDashboard();
                    loadAdminAppointments();
                    generateTimeSlots();
                    showAlert('Agendamento cancelado com sucesso!', 'success');
                } else {
                    showAlert('Erro ao cancelar agendamento', 'error');
                }
            }
        }
        
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => alertDiv.remove(), 5000);
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('loginError').style.display = 'none';
        }
        
        function updateAdminUI() {
            const adminDashboard = document.getElementById('adminDashboard');
            const loginRequired = document.getElementById('loginRequired');
            
            if (isAdminAuthenticated) {
                if (adminDashboard) adminDashboard.classList.remove('d-none');
                if (loginRequired) loginRequired.classList.add('d-none');
                updateAdminDashboard();
                loadAdminAppointments();
            } else {
                if (adminDashboard) adminDashboard.classList.add('d-none');
                if (loginRequired) loginRequired.classList.remove('d-none');
            }
        }
        
        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Navegação entre abas
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    if (tabId === 'admin' && !isAdminAuthenticated) {
                        updateAdminUI();
                    }
                });
            });
            
            // Envio do formulário de agendamento
            document.getElementById('booking-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const agendamento = {
                    clientName: document.getElementById('client-name').value,
                    phone: document.getElementById('client-phone').value,
                    service: document.getElementById('service-type').value,
                    date: document.getElementById('appointment-date').value,
                    time: document.getElementById('selected-time').value,
                    notes: document.getElementById('notes').value
                };
                
                if (!agendamento.time) {
                    showAlert('Por favor, selecione um horário disponível.', 'error');
                    return;
                }
                
                if (!agendamento.service) {
                    showAlert('Por favor, selecione um serviço.', 'error');
                    return;
                }
                
                const resultado = await salvarAgendamentoNoFirestore(agendamento);
                
                if (resultado.success) {
                    appointments.push({
                        id: resultado.id,
                        ...agendamento,
                        status: 'pending',
                        criadoEm: new Date()
                    });
                    
                    document.getElementById('success-message').classList.remove('d-none');
                    this.reset();
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('appointment-date').value = today;
                    document.getElementById('selected-time').value = '';
                    
                    generateTimeSlots();
                    window.scrollTo(0, 0);
                    
                    setTimeout(() => {
                        document.getElementById('success-message').classList.add('d-none');
                    }, 5000);
                } else {
                    showAlert('Erro ao salvar agendamento: ' + resultado.error, 'error');
                }
            });
            
            // Filtro de data na área administrativa
            document.getElementById('filter-date').addEventListener('change', function() {
                if (isAdminAuthenticated) loadAdminAppointments();
            });
            
            // Botão de logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                fazerLogout();
                isAdminAuthenticated = false;
                updateAdminUI();
                document.querySelector('.tab[data-tab="client"]').click();
                showAlert('Logout realizado com sucesso!', 'success');
            });
            
            // Botões para abrir modal de login
            document.getElementById('openLoginModal').addEventListener('click', showLoginModal);
            document.getElementById('adminAccessLink').addEventListener('click', function(e) {
                e.preventDefault();
                showLoginModal();
            });
            
            // Formulário de login
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const loginError = document.getElementById('loginError');
                
                const resultado = await fazerLogin(email, password);
                
                if (resultado.success) {
                    hideLoginModal();
                    isAdminAuthenticated = true;
                    updateAdminUI();
                    showAlert('Login realizado com sucesso!', 'success');
                } else {
                    loginError.textContent = resultado.error;
                    loginError.style.display = 'block';
                }
            });
            
            // Botão para fechar modal
            document.getElementById('closeModal').addEventListener('click', hideLoginModal);
            
            // Fechar modal ao clicar fora
            document.getElementById('loginModal').addEventListener('click', function(e) {
                if (e.target === this) hideLoginModal();
            });
            
            // Mudança de data no agendamento
            document.getElementById('appointment-date').addEventListener('change', generateTimeSlots);
        }
        
        // ========== INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointment-date').min = today;
            document.getElementById('appointment-date').value = today;
            document.getElementById('filter-date').value = today;
            
            // Configurar ano atual no footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Inicializar Firebase auth state observer
            auth.onAuthStateChanged((user) => {
                currentUser = user;
                isAdminAuthenticated = !!user;
                
                if (user) {
                    console.log("Usuário autenticado:", user.email);
                    carregarAgendamentosDoBanco();
                } else {
                    console.log("Nenhum usuário autenticado");
                }
                
                updateAdminUI();
            });
            
            // Configurar eventos
            setupEventListeners();
            
            // Carregar dados iniciais
            carregarAgendamentosDoBanco();
        });
    </script>
</body>
</html>